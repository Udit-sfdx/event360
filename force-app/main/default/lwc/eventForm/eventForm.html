<template>
    <div class="event-form-wrap">
        <lightning-card class="form-card" title="Create New Event" icon-name="standard:event">
            <div class="slds-p-around_medium">
                <lightning-messages></lightning-messages>
                <div class="slds-grid slds-wrap slds-gutters_small">
                    <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                        <lightning-input 
                            label="Event Name" 
                            name="Name" 
                            value={eventDetail.Name}
                            onchange={handleInputChange} 
                            required
                            field-level-help="Enter the official event name as it will appear to attendees.">
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                        <lightning-input 
                            type="datetime" 
                            label="Start Date & Time" 
                            name="StartDateTime__c"
                            value={eventDetail.StartDateTime__c} 
                            onchange={handleInputChange} 
                            required
                            min={minDateTime}
                            field-level-help="Select the date and time when the event will begin.">
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2"> 
                        <lightning-input 
                            type="number" 
                            label="Duration (Hours)" 
                            name="DurationInMinutes__c" 
                            value={eventDetail.DurationInMinutes__c} 
                            disabled
                            required 
                            field-level-help="Auto Calculated from the duration of each session (e.g., Between 1 to 8 ).">
                        </lightning-input> 
                    </div> 
                    <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2"> 
                        <lightning-input 
                            label="Event Type" 
                            name="Type__c" 
                            value={eventDetail.Type__c} 
                            onchange={handleInputChange} 
                            placeholder="Conference, Workshop, Webinar, etc." 
                            field-level-help="Type of event â€” e.g., Conference, Workshop, Webinar. Helps categorize events for search and filtering."> 
                        </lightning-input> 
                    </div> 
                    <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2"> 
                        <lightning-input 
                            label="Location" 
                            name="Location__c" 
                            value={eventDetail.Location__c} 
                            onchange={handleInputChange} 
                            title="Enter the city, venue name, or 'Online' if virtual." 
                            field-level-help="Specify the city, hall, or online platform (e.g., Zoom)."> 
                        </lightning-input> 
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2"> 
                        <lightning-input 
                            label="Venue" 
                            name="Venue__c" 
                            value={eventDetail.Venue__c} 
                            onchange={handleInputChange} 
                            field-level-help="Provide the specific venue or room name (e.g., Hall A, Conference Room 2)."> 
                        </lightning-input> 
                    </div> 
                    <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2"> 
                        <lightning-input 
                            type="number" 
                            label="Price" 
                            name="Price__c" 
							formatter="currency"
							currency-code="USD"
                            value={eventDetail.Price__c}
							disabled="true"
                            field-level-help="Ticket price in your org's currency. Leave blank or enter 0 for free events."> 
                        </lightning-input> 
                    </div> 
                    <div class="file-upload-col slds-col slds-size_1-of-1 slds-medium-size_1-of-2"> 
                        <lightning-file-upload 
                            label="Upload Event Image" 
                            name="imageUpload" 
                            accept={acceptedFormats} 
                            record-id={eventDetail.Id} 
                            onuploadfinished={handleFileUpload} 
                            title="Upload an event image (PNG, JPG)."> 
                        </lightning-file-upload> 
                    </div> 
                    <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2"> 
                        <lightning-combobox 
                            label="Status" 
                            name="Status__c" 
                            value={eventDetail.Status__c} 
                            options={statusOptions} 
                            onchange={handleInputChange} 
                            field-level-help="Set the event status (e.g., Draft, Published, Cancelled)."> 
                        </lightning-combobox> 
                    </div> 
                    <div class="slds-col slds-size_1-of-1"> 
                        <lightning-textarea 
                            label="Description" 
                            name="Description__c" 
                            value={eventDetail.Description__c} 
                            onchange={handleInputChange} 
                            placeholder="Write a short description (max 300 chars)" 
                            field-level-help="A short description for attendees. Keep it under 300 characters for best display in previews."> 
                        </lightning-textarea> 
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-m-top_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_small">Event Sessions</h3>
						<template for:each={sessions} for:item="session" for:index="index">
                            <div class="session-card" key={session.id} data-session-index={index}>
                                <div class="session-grid">
                                    <lightning-input 
                                        class="full-width"
                                        label="Session Name" 
                                        name="sessionName" 
                                        value={session.sessionName} 
                                        data-index={index} 
                                        onchange={handleSessionChange} 
                                        required
                                        field-level-help="Enter the name of the session">
                                    </lightning-input>
                                    <lightning-input 
                                        label="Speaker" 
                                        name="speaker" 
                                        value={session.speaker} 
                                        data-index={index} 
                                        onchange={handleSessionChange}
                                        field-level-help="Enter the speaker's name">
                                    </lightning-input>
                                    <lightning-input 
                                        type="date" 
                                        label="Start Date" 
                                        name="startDate" 
                                        value={session.startDate} 
                                        data-index={index} 
                                        min={minDateTime}
                                        onchange={handleSessionChange}
                                        field-level-help="Select the session start date">
                                    </lightning-input>
                                    <lightning-input 
                                        type="time" 
                                        label="Start Time" 
                                        name="startTime" 
                                        value={session.startTime} 
                                        data-index={index} 
                                        onchange={handleSessionChange}
                                        field-level-help="Select the session start time">
                                    </lightning-input>
                                    <lightning-input 
                                        type="number" 
                                        label="Duration (Hours)" 
                                        name="duration" 
                                        value={session.duration} 
                                        data-index={index} 
                                        onchange={handleSessionChange}
                                        field-level-help="Enter the duration of the session in hours between 1 to 8">
                                    </lightning-input>
                                    <lightning-input 
                                        class="full-width"
                                        label="Location" 
                                        name="location" 
                                        value={session.location} 
                                        data-index={index} 
                                        onchange={handleSessionChange}
                                        field-level-help="Enter the location of the session">
                                    </lightning-input>
                                    <lightning-input 
                                        type="number" 
                                        label="Price" 
                                        name="price" 
										formatter="currency"
										currency-code="USD"
                                        value={session.price} 
                                        data-index={index} 
                                        onchange={handleSessionChange}
                                        field-level-help="Enter the price for attending this session (in USD)">
                                    </lightning-input>
                                </div>
                                <lightning-button 
                                    class="remove-session-btn" 
                                    label="Remove Session" 
                                    variant="destructive" 
                                    data-index={index} 
                                    disabled={isOnlyOne}
                                    onclick={handleRemoveSession}
                                    field-level-help="Click to remove this session">
                                </lightning-button>
                            </div>
                        </template>
                        <lightning-button 
                            class="add-session-btn" 
                            label="Add Session" 
                            variant="neutral" 
                            onclick={handleAddSession}>
                        </lightning-button>
                    </div>
                    <div class="slds-col slds-size_1-of-1 slds-m-top_medium">
                        <lightning-button 
                            variant="brand" 
                            label="Save Event" 
                            onclick={handleSaveEvent} 
                            class="slds-m-right_small">
                        </lightning-button>

                        <lightning-button 
                            label="Cancel" 
                            onclick={handleCancel}>
                        </lightning-button>
                    </div>
				</div>
                <template if:true={isLoading}>
                    <div class="overlay">
                        <lightning-spinner alternative-text="Saving" size="large"></lightning-spinner>
                    </div>
                </template>
			</div>
        </lightning-card>
    </div>
</template>
